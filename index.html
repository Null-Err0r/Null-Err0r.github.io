<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <style>
    html, body {
      background-color: #1a1a1a;
      margin: 0;
      padding: 0;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Mr. SAM</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
  <link rel="shortcut icon" href="favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
  <link rel="manifest" href="favicon/site.webmanifest" />

<style>
  :root {
    --primary-color: #00ffcc;
    --bg-color: #1a1a1a;
    --text-color: #e0e0e0;
    --shadow-dark: #111111;
    --shadow-light: #232323;
    --text-muted: #888;
    font-size: 16px;
  }

  html {
    box-sizing: border-box;
  }
  *, *::before, *::after {
    box-sizing: inherit;
  }

  html, body {
    height: 100%;
    min-height: var(--app-height, 100vh);
    background-color: transparent;
    font-family: 'Vazirmatn', 'Fira Mono', monospace;
    color: var(--primary-color);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    user-select: none;
    overflow: hidden;
    direction: rtl;
    display: flex;
    position: relative;
    touch-action: manipulation;
  }

  #tsparticles {
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  html[lang="en"] {
    font-family: 'Fira Mono', monospace;
    direction: ltr;
  }

  #terminal {
    height: var(--app-height, 100vh);
    width: 100vw;
    display: flex;
    flex-direction: column;
    background-color: transparent;
    padding: 0.625rem;
    text-align: right;
    transition: width 0.3s ease;
    z-index: 1;
    overflow-y: auto;
  }

  html[lang="en"] #terminal {
    text-align: left;
  }

  .split #terminal {
    width: 50vw;
  }

  #output {
    flex-grow: 1;
    overflow-y: auto;
    overflow-x: auto;
    white-space: pre;
    line-height: 1.4;
    font-size: 1rem;
    user-select: text;
    margin: 0.625rem 0;
    color: #ffffff;
    text-align: inherit;
    max-height: calc(100vh - 5rem);
    padding-bottom: 1.25rem;
  }

  body:not(.terminal-mode) #output {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .welcome-logo {
    font-family: 'Fira Mono', monospace;
    font-size: 2.5rem;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 0.3125rem var(--primary-color), 0 0 0.625rem var(--primary-color);
    animation: fadeIn 2s ease-in-out;
    cursor: pointer;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .welcome-hint {
    color: #777;
    font-size: 0.8rem;
    margin-top: 0.9375rem;
    cursor: pointer;
    animation: fadeIn 2s ease-in-out 0.5s;
    animation-fill-mode: backwards;
  }

  #output a {
    color: #00cc7a;
    text-decoration: underline;
  }
  #output a:hover {
    color: #00ff99;
  }

  #prompt-wrapper {
    display: none;
    align-items: center;
    border-top: 2px solid #ffffffcc;
    background: #000;
    padding: 0.5rem;
    position: sticky;
    bottom: 0;
    z-index: 10;
  }

  body.terminal-mode #prompt-wrapper {
    display: flex;
  }

  html[lang="fa"] #prompt-wrapper {
    flex-direction: row-reverse;
  }

  #commandInput {
    border: none;
    background: transparent;
    color: #ffffff;
    font-family: 'Vazirmatn', 'Fira Mono', monospace;
    font-size: 1.1rem;
    outline: none;
    width: 100%;
    user-select: text;
    text-align: inherit;
  }

  html[lang="fa"] #commandInput {
    padding-right: 0.3125rem;
  }
  html[lang="en"] #commandInput {
    padding-left: 0.3125rem;
  }

  .lang-buttons {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0.625rem;
    width: 100%;
    padding: 0.625rem 0.9375rem;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .lang-btn {
    padding: 0.5rem 1rem;
    font-family: 'Vazirmatn', 'Fira Mono', monospace;
    font-size: 1rem;
    color: #ffffff;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.3125rem;
    user-select: none;
    transition: background-color 0.3s ease;
    text-align: center;
    backdrop-filter: blur(0.3125rem);
    flex-shrink: 0;
    cursor: pointer;
  }

  .lang-btn:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }
  .lang-btn.active {
    background-color: var(--primary-color);
    color: #000;
  }

  .header-gif {
    height: 2.8125rem;
    width: auto;
    margin: 0 0.625rem;
    opacity: 0.8;
    flex-shrink: 0;
  }

  .time-display {
    color: #e0e0e0;
    font-size: 0.9rem;
    font-weight: bold;
    font-family: 'Fira Mono', monospace;
    background-color: transparent;
    padding: 0.3125rem 0.75rem;
    border-radius: 0.3125rem;
    text-align: center;
    direction: ltr;
    line-height: 1.5;
    text-shadow: 0 0 0.1875rem rgba(0, 255, 204, 0.2);
    flex-shrink: 0;
  }

  .header-gif { order: 1; }
  #langFaBtn  { order: 2; }
  #langEnBtn  { order: 3; }
  #time-en    { order: 4; }
  #time-fa    { order: 5; display: none; }

  html[lang="fa"] #time-fa    { order: 1; display: block; }
  html[lang="fa"] #langFaBtn  { order: 2; }
  html[lang="fa"] #langEnBtn  { order: 3; }
  html[lang="fa"] .header-gif { order: 4; }
  html[lang="fa"] #time-en    { order: 5; display: none; }

  html[lang="en"] #time-en { display: block; }
  html[lang="en"] #time-fa { display: none; }

  @media (max-width: 48rem) {
    body {
      overflow-y: auto !important;
    }
    #terminal {
      padding-top: 4.375rem !important;
      padding-bottom: 1.25rem !important;
    }
    .lang-buttons {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      margin: 0;
      padding: 0.5rem 0.3125rem;
      gap: 0.3125rem;
      z-index: 1001;
      background-color: transparent;
    }
    .lang-btn {
      padding: 0.375rem 0.75rem;
      font-size: 0.9rem;
    }
    .header-gif {
      height: 2.5rem;
      margin: 0 0.3125rem;
    }
    .time-display {
      font-size: 0.8rem;
      padding: 0.25rem 0.5rem;
      line-height: 1.4;
    }
    .welcome-logo {
      font-size: 2rem;
    }
    .split #terminal {
      width: 100vw !important;
    }
    #panel {
      width: 100vw !important;
      height: 100vh !important;
      border: none !important;
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      z-index: 2000 !important;
    }
    #gui-controls {
      flex-direction: column;
      align-items: center;
    }
    .glass-btn {
      width: 80%;
      max-width: 21.875rem;
      padding: 1.125rem;
    }
    .about-me-wrapper .row {
      flex-direction: column !important;
      align-items: center;
      gap: 0.9375rem;
    }
    .about-me-wrapper .row img {
      width: 95% !important;
      max-width: 28.125rem;
    }
  }

  #gui-controls {
    display: none;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 0.9375rem;
    padding: 1.25rem 0;
    width: 100%;
  }

  body:not(.terminal-mode) #gui-controls {
    display: flex;
  }

  .glass-btn {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    padding: 0.9375rem 1.5625rem;
    color: #e0e0e0;
    font-family: 'Vazirmatn', sans-serif;
    font-size: 1rem;
    font-weight: bold;
    transition: all 0.3s ease;
    backdrop-filter: blur(0.625rem);
    box-shadow: 0 0.25rem 1.875rem rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    min-width: 12.5rem;
    cursor: pointer;
  }

  html[lang="en"] .glass-btn {
    font-family: 'Fira Mono', monospace;
  }

  .glass-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-0.1875rem);
    box-shadow: 0 0.5rem 1.875rem rgba(0, 0, 0, 0.2);
  }

  .glass-btn i {
    font-size: 1.2rem;
    color: var(--primary-color);
  }

  #panel {
    display: none;
    width: 50vw;
    height: var(--app-height, 100vh);
    background-color: #000;
    color: #ffffff;
    padding: 0.625rem;
    padding-top: 2.8125rem;
    font-family: 'Vazirmatn', 'Fira Mono', monospace;
    animation: slideIn 0.3s ease;
    z-index: 50;
    border-left: 1px solid #30363d;
    position: relative;
  }

  @keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
  }

  html[lang="en"] #panel {
    text-align: left;
    animation-name: slideInEn;
    border-left: none;
    border-right: 1px solid #30363d;
  }

  @keyframes slideInEn {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
  }

  #panel-content {
    height: 100%;
    overflow-y: auto;
    position: relative;
    padding-bottom: 3.75rem;
  }

  #panel-content iframe {
    width: 100%;
    height: 100%;
    border: none;
    background-color: #1a1a1a;
  }

  #close-panel {
    position: absolute;
    top: 0.625rem;
    left: 0.625rem;
    padding: 0.25rem 0.625rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.25rem;
    color: #ffffff;
    font-family: 'Vazirmatn', sans-serif;
    z-index: 1000;
    cursor: pointer;
  }
  #close-panel:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }

  .progress-container {
    position: absolute;
    bottom: 0.9375rem;
    left: 50%;
    transform: translateX(-50%);
    width: 9.375rem;
    height: 0.9375rem;
    background-color: #022a1c;
    border-radius: 0.5rem;
    overflow: hidden;
    z-index: 1001;
    display: none;
    box-shadow: 0 0 0.5rem rgba(0, 204, 122, 0.5);
  }
  .progress-bar {
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #00cc7a, #00ff99);
    transition: width 1.5s ease-in-out;
  }
  .progress-container.loading {
    display: block;
  }

  #output::-webkit-scrollbar,
  #panel-content::-webkit-scrollbar {
    width: 0.5rem;
  }
  #output::-webkit-scrollbar-track,
  #panel-content::-webkit-scrollbar-track {
    background: #010409;
  }
  #output::-webkit-scrollbar-thumb,
  #panel-content::-webkit-scrollbar-thumb {
    background: #30363d;
    border-radius: 0.375rem;
  }

  .visitor, .stats, .projects, .other-projects, .footer {
    margin-bottom: 0.9375rem;
    text-align: center;
  }
  .projects h2, .other-projects h2 {
    font-size: 1.3rem;
    margin-bottom: 0.5rem;
    color: var(--primary-color);
  }
  .project-list-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    gap: 0.5rem;
  }
  .project-list-container > div {
    padding: 0.75rem;
    background-color: #022a1c;
    border: 1px solid #00cc7a;
    border-radius: 0.375rem;
    width: 90%;
    max-width: 21.875rem;
    text-align: center;
  }
  .project-list-container a {
    color: var(--primary-color);
    font-size: 1rem;
    text-decoration: none;
    font-weight: bold;
  }
  .project-list-container a:hover {
    color: #33ff99;
    text-decoration: underline;
  }
  .project-list-container p {
    color: #ffffff;
    font-size: 0.8rem;
    margin-top: 0.3125rem;
  }
  .project-list {
    list-style: none;
    padding: 0;
    margin: 0;
    text-align: center;
  }
  .project-list li {
    margin: 0.5rem 0;
  }
  .project-list a {
    color: #00cc7a;
    text-decoration: none;
    font-size: 0.9rem;
  }
  .project-list a:hover {
    color: #00ff99;
    text-decoration: underline;
  }

  .icon-combo {
    display: inline-flex;
    align-items: center;
    gap: 0.3125rem;
    color: var(--primary-color);
    vertical-align: middle;
  }

  .about-me-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    gap: 2.5rem;
  }

  .bio-container {
    max-width: 30rem;
    margin: 0 auto;
    text-align: center;
    color: #f0f0f0;
    padding: 1rem;
  }
  .bio-container .avatar {
    width: 12.5rem;
    height: 12.5rem;
    border-radius: 50%;
    margin: 1rem auto;
    object-fit: contain;
    background-color: #000;
    border: 3px solid #f0f0f0;
  }
  .avatar-wrapper {
    position: relative;
    display: inline-block;
  }
  .glow-ring {
    content: '';
    position: absolute;
    top: -0.9375rem;
    left: -0.9375rem;
    width: calc(100% + 1.875rem);
    height: calc(100% + 1.875rem);
    border-radius: 50%;
    background: conic-gradient(from 0deg, #00ffcc, #002a17, #00ffcc);
    animation: spin 4s linear infinite;
    z-index: -1;
    filter: blur(0.75rem);
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .bio-container h1 {
    font-size: 1.5rem;
    margin: 0.5rem 0;
  }
  .bio-container .bio {
    color: #ccc;
    font-size: 1rem;
    margin-bottom: 2rem;
  }
  .bio-container .link-button {
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none !important;
    margin: 0.5rem 0;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    color: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 0.125rem 0.5rem rgba(0,0,0,0.3);
    transition: transform 0.2s ease, background 0.2s;
  }
  .bio-container .link-button:hover {
    transform: scale(1.02);
    background: rgba(255, 255, 255, 0.15);
  }
  .bio-container .link-button i {
    margin-left: 0.5rem;
  }

  #globe-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    z-index: -2;
  }

.fab-button {
  position: fixed;
  bottom: 4.5rem;
  z-index: 1000;
  animation: breathe 4s infinite ease-in-out;
  width: 3.4375rem;
  height: 3.4375rem;
  background-color: transparent;
  border: 1px solid rgba(0, 255, 204, 0.5);
  border-radius: 50%;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  transition: all 0.3s ease;
  cursor: pointer;
}

#ai-fab {
  right: 1.25rem;
}
#music-fab {
  left: 1.25rem;
  transition: left 0.3s ease, right 0.3s ease;
}

.fab-button:hover {
  animation-play-state: paused;
  border-color: var(--primary-color);
  box-shadow: 0 0 20px 0px var(--primary-color);
  transform: translateY(-0.25rem) scale(1.1);
}

@keyframes illuminate {
  0% {
    text-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
  }
  50% {
    text-shadow: 0 0 16px var(--primary-color), 0 0 12px #fff;
  }
  100% {
    text-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
  }
}

.icon-combo {
  position: relative;
  width: 2.2rem;
  height: 2.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.icon-combo i {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.icon-back {
  font-size: 2.2rem;
  color: var(--primary-color);
}

.icon-front {
  font-size: 0.7rem;
  color: rgba(0, 255, 204, 0.5);
  top: 85%;
}

.fab-button:hover .icon-front {
  color: #fff;
  text-shadow: 0 0 8px #fff;
  transform: translate(-50%, -50%) scale(1.2);
}

.fab-button:hover .icon-back {
  animation: illuminate 1.2s ease-in-out;
}

.fab-tooltip {
  display: none;
}

@media (min-width: 48.01rem) {
  .fab-tooltip {
    display: block;
    position: absolute;
    background-color: var(--primary-color);
    color: #000;
    padding: 0.3rem 0.8rem;
    border-radius: 5px;
    font-size: 0.9rem;
    font-family: 'Vazirmatn', sans-serif;
    white-space: nowrap;
    z-index: 1001;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
  }

  #ai-fab .fab-tooltip {
    top: 50%;
    right: 115%;
    transform: translateY(-50%);
  }
  
  #music-fab .fab-tooltip {
    top: 50%;
    left: 115%; 
    transform: translateY(-50%);
  }

  .fab-button:hover .fab-tooltip {
    opacity: 1;
    visibility: visible;
  }
}

@media (max-width: 48rem) {
  .fab-button {
    width: 3.125rem;
    height: 3.125rem;
    font-size: 1.375rem;
    bottom: 4.5rem;
  }
  #ai-fab {
    right: 1rem;
  }
  #music-fab {
    left: 1rem;
  }
  body.terminal-mode .fab-button {
    bottom: 4rem;
  }
}

body.split #music-fab {
    left: auto;
    right: 5rem;
}

@keyframes breathe {
  0% {
    box-shadow: 0 0 15px -2px rgba(0, 255, 204, 0.4);
  }
  50% {
    box-shadow: 0 0 25px 0px rgba(0, 255, 204, 0.8);
  }
  100% {
    box-shadow: 0 0 15px -2px rgba(0, 255, 204, 0.4);
  }
}

.welcome-logo {
  position: relative;
}

.welcome-logo::after {
  content: '';
  position: absolute;
  right: -0.6em;
  top: -0.05em;
  font-size: 1.1em;
  animation: blink-cursor 1.1s infinite step-end;
}

@keyframes blink-cursor {
  from, to { color: transparent; }
  50% { color: var(--primary-color); }
}

.welcome-logo.typing-done::after {
  display: none;
}

.glass-btn {
  position: relative;
  overflow: hidden;
}

.glass-btn::before {
  content: '';
  position: absolute;
  width: 150px;
  height: 150px;
  left: var(--mouse-x, -75px);
  top: var(--mouse-y, -75px);
  background: radial-gradient(circle closest-side, rgba(0, 255, 204, 0.3), transparent);
  opacity: 0;
  transition: opacity 0.4s;
}

.glass-btn:hover::before {
  opacity: 1;
}

#ai-fab .icon-back {
  font-size: 2rem;
}

#ai-fab .icon-combo {
  transform: rotate(-850deg);
}

body {
    font-family: 'Vazirmatn', sans-serif;
    background-color: var(--bg-color);
    margin: 0;
    color: var(--text-color);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
    user-select: none;
}

button, [onclick] {
    cursor: pointer;
}
    #music-player {
        position: fixed;
        bottom: -300px;
        left: 50%;
        transform: translateX(-50%);
        width: 95%;
        max-width: 800px;
        background: rgba(26, 26, 26, 0.5);
        backdrop-filter: blur(10px);
        display: grid;
        grid-template-columns: 250px 1fr 200px;
        align-items: center;
        gap: 20px;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
        transition: bottom 0.5s ease-in-out, left 0s, top 0s, width 0s, transform 0s;
        box-sizing: border-box;
        z-index: 1002;
    }
    #music-player.dragging {
        user-select: none;
        transition: none; 
    }
    #music-player.visible { 
        bottom: 20px; 
    }

    #playlist-container { position: relative; }
    #playlist { width: 100%; max-height: 110px; overflow-y: auto; list-style: none; padding: 0; margin: 0; background: rgba(37, 40, 46, 0.7); border-radius: 10px; box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); }
    #playlist li { padding: 10px 15px; border-bottom: 1px solid rgba(58, 62, 71, 0.7); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: background-color 0.2s; cursor: pointer; }
    #playlist li:last-child { border-bottom: none; }
    #playlist li:hover { background-color: #3c4049; }
    #playlist li.playing { background-color: var(--primary-color); color: #fff; font-weight: bold; }
    .center-controls { display: flex; flex-direction: column; align-items: center; width: 100%; }
    .player-buttons { display: flex; align-items: center; margin-bottom: 15px; }
    .player-buttons button { width: 50px; height: 50px; margin: 0 15px; border: none; border-radius: 50%; background: rgba(26, 26, 26, 0.7); color: var(--text-color); display: flex; justify-content: center; align-items: center; box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); transition: all 0.2s ease-in-out; }
    .player-buttons button svg { width: 20px; height: 20px; fill: currentColor; }
    .player-buttons button#play-pause-btn { width: 60px; height: 60px; color: var(--primary-color); }
    .player-buttons button#play-pause-btn svg { width: 24px; height: 24px; }
    .player-buttons button:active { box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); transform: scale(0.95); }
    #music-player .progress-container { width: 100%; height: 8px; background: #25282e; border-radius: 10px; box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); position: relative; bottom: auto; left: auto; transform: none; display: block; overflow: visible; cursor: pointer; }
    #music-player #progress-bar { width: 0%; height: 100%; background-color: var(--primary-color); border-radius: 10px; transition: none; pointer-events: none; }
    .time-stamps { display: flex; justify-content: space-between; width: 100%; font-size: 12px; margin-top: 5px; color: var(--text-muted); }
    .info-volume-controls { display: flex; flex-direction: column; align-items: center; }
    #now-playing { font-weight: bold; margin-bottom: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; text-align: center; }
    .volume-controls { display: flex; align-items: center; width: 100%; }
    .volume-controls svg { width: 20px; height: 20px; fill: var(--text-muted); margin: 0 10px; cursor: pointer; }
    #volume-slider { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: #25282e; border-radius: 5px; outline: none; box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light); cursor: pointer; }
    #volume-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--primary-color); border-radius: 50%; cursor: pointer; }

    #now-playing-mobile { display: none; }
    @media (max-width: 768px) {
        #music-player {
            grid-template-columns: 1fr;
            gap: 15px;
            width: 95vw;
            padding: 15px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #music-player.visible { 
            bottom: 10px;
        }
        #playlist-container { order: 5; width: 100%; }
        .center-controls { order: 3; width: 100%; }
        .info-volume-controls { order: 2; width: 100%; }
        #now-playing-mobile { order: 1; text-align: center; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; display: block; }
        #now-playing { display: none; }
        .player-buttons button { width: 45px; height: 45px; margin: 0 10px; }
        .player-buttons button#play-pause-btn { width: 55px; height: 55px; }
        #playlist { max-height: 80px; }
    }

    #panel-content img {
        pointer-events: auto !important;
    }
     
#close-player-btn {
    position: absolute;
    top: 15px;
    left: 15px;
    width: 30px;
    height: 30px;
    background: rgba(30, 30, 30, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    color: #e0e0e0;
    font-size: 22px;
    line-height: 28px;
    text-align: center;
    padding: 0;
    cursor: pointer;
    backdrop-filter: blur(5px);
    transition: all 0.2s ease-in-out;
    z-index: 10;
}

#close-player-btn:hover {
    background: rgba(255, 85, 85, 0.7);
    color: #fff;
    transform: scale(1.1) rotate(90deg);
}

@media (max-width: 768px) {
    #close-player-btn {
        top: 12px;
        left: 12px;
    }
}
</style>

</head>

<body>

    <div id="tsparticles"></div>
    <div id="terminal" role="main" aria-label="Terminal Portfolio">

<div class="lang-buttons">
    <button class="lang-btn" id="langFaBtn" aria-label="تغییر به فارسی">فارسی</button>
    <button class="lang-btn" id="langEnBtn" aria-label="Switch to English">English</button>
    <span id="time-fa" class="time-display"></span>
    <span id="time-en" class="time-display"></span>
    <img src="content/shapes.gif" alt="Globe GIF" class="header-gif" />
</div>

    <div id="gui-controls"></div>
    <pre id="output" aria-live="polite" aria-atomic="false"></pre>
    <div id="prompt-wrapper">
        <span id="prompt-label"></span>
        <input type="text" id="commandInput" autocomplete="off" autofocus aria-label="Command input" spellcheck="false" inputmode="text" />
    </div>
  </div>
  <div id="panel" role="dialog" aria-label="Content Panel">
    <button id="close-panel" aria-label="Close panel">X</button>
    <div id="panel-content"></div>
  </div>
  <script>
    const decoyPartB64 = 'ZGVsYmFyODY3MQ==';
    const ENCRYPTED_AI_WORKER_URL = 'JQZaUCB7YlsDHgwdQxUEBQ8KAB5JUVgAWVxZQVZDKRBHTiAgIB1LBQIbBQQeA08KABpL';
    function generateKey() {
        const p1 = document.title;
        const p2 = document.getElementById('terminal').id;
        const p3 = document.getElementById('panel').id;
        const p4 = atob(decoyPartB64);
        return p1 + p2 + p3 + p4;
    }
    
    function typeWriter(element, text, i = 0) {
      if (i < text.length) {
        element.innerHTML += text.charAt(i);
        setTimeout(() => typeWriter(element, text, i + 1), 120); 
      } else {
        element.classList.add('typing-done');
      }
    }

    function decryptUrl(encodedStr) {
        try {
            const dynamicKey = generateKey();
            const xorResult = atob(encodedStr);
            let originalStr = '';
            for (let i = 0; i < xorResult.length; i++) {
                originalStr += String.fromCharCode(xorResult.charCodeAt(i) ^ dynamicKey.charCodeAt(i % dynamicKey.length));
            }
            return originalStr;
        } catch (e) {
            console.error("Decryption failed:", e);
            return "";
        }
    }

    const input = document.getElementById('commandInput');
    const output = document.getElementById('output');
    const langFaBtn = document.getElementById('langFaBtn');
    const langEnBtn = document.getElementById('langEnBtn');
    const panel = document.getElementById('panel');
    const panelContent = document.getElementById('panel-content');
    const closePanelBtn = document.getElementById('close-panel');
    const guiControls = document.getElementById('gui-controls');
    const timeFaDisplay = document.getElementById('time-fa');
    const timeEnDisplay = document.getElementById('time-en');
    let lang = 'fa';
    let isTerminalMode = false;
    let cachedProjectsContent = null;
    let cachedAboutContent = {};
    let commandHistory = [];
    let historyIndex = -1;
    let introHasRun = { fa: false, en: false };

    const TIME_CORRECTION_OFFSET = 0 ;


    function loadGlobeBackground() {
        const globeIframe = document.createElement('iframe');
        globeIframe.id = 'globe-background';
        globeIframe.style.opacity = '0';
        globeIframe.style.transition = 'opacity 1.5s ease-in-out';
        globeIframe.onload = () => {
            globeIframe.style.opacity = '1';
        };
        
        globeIframe.src = 'https://nullglobeworker.awardbinsami.workers.dev/'; 
        globeIframe.style.position = 'fixed';
        globeIframe.style.top = '0';
        globeIframe.style.left = '0';
        globeIframe.style.width = '100vw';
        globeIframe.style.height = '100vh';
        globeIframe.style.border = 'none';
        globeIframe.style.zIndex = '-2';
        document.body.appendChild(globeIframe);
    }
        
    const messages = {
      en: {
        intro: [],
        gibberish: [
            "Initializing secure core ... [OK]",
            "Verifying digital signature ... [MATCH]",
            "Establishing encrypted link ... [LOCKED]",
            "Analyzing system integrity ... [SECURE]",
            "Loading security protocols ... [ACTIVE]",
            "Awaiting secure handshake ... [CONFIRMED]",
            "Final security check ... [PASS]"
        ],
        prompt: "> ",
        welcome: `Welcome`,
        promptHelp: `Type 'help' for commands. Press 'Esc' to exit terminal.`,
        helpText: `Available commands:\n- about: Who am I\n- commands: Windows, Linux & RE commands\n- updates: The Newest in Security\n- ai: Open AI Assistant\n- chatbot: Open AI Assistant\n- clear: Clear the terminal\n- exit: Exit terminal mode`,
        projectsLoading: `... Updating ...`,
        projectsError: `Error fetching. Visit: https://github.com/null-err0r`,
        langSwitched: `Language switched to English.`,
        cmdNotFound: `Command not found. Type 'help'.`,
        torDetected: `[!] Tor network detected.`,
        guiHint: "Press 'Esc' or click here to enter and exit Terminal"
      },
      fa: {
        intro: [],
        gibberish: [
            "راه‌اندازی هسته امن ... [تأیید]",
            "بررسی امضای دیجیتال ... [مطابق]",
            "ایجاد پیوند رمزنگاری‌شده ... [قفل شد]",
            "تحلیل یکپارچگی سیستم ... [امن]",
            "بارگذاری پروتکل‌های امنیتی ... [فعال]",
            "در انتظار دست‌دهی امن ... [تأیید شد]",
            "بررسی نهایی امنیت ... [موفق]"
        ],
        prompt: "> ",
        welcome: `خوش آمدید`,
        promptHelp: `برای شروع 'راهنما' را تایپ کنید. برای خروج از حالت ترمینال کلید 'Esc' را فشار دهید.`,
        helpText: `دستورات موجود:\n- درباره: درباره من\n- دستورات: دستورات ویندوز، لینوکس و مهندسی معکوس\n- تازه ها: جدیدترین ها از دنیای امنیت\n- هوش مصنوعی: گفتگوی متنی با هوش مصنوعی\n- چت بات: گفتگوی متنی با هوش مصنوعی\n- پاک کن: پاک کردن ترمینال\n- خروج: خروج از حالت ترمینال`,
        projectsLoading: `در حال بروز رسانی ...`,
        projectsError: `خطا در دریافت. به این آدرس مراجعه کنید: https://github.com/null-err0r`,
        langSwitched: `زبان به فارسی تغییر یافت.`,
        cmdNotFound: `دستور یافت نشد. برای مشاهده دستورات 'راهنما' را تایپ کنید.`,
        torDetected: `[!] شبکه Tor شناسایی شد.`,
        guiHint: "برای ورود و خروج از ترمینال کلید 'Esc' را فشار دهید یا اینجا کلیک کنید"
      }
    };


    const aiAssistantContent = `
        <!DOCTYPE html>
        <html lang="fa" dir="rtl">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Mr. SAM</title>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
            <style>
                :root {
                    --background: #1a1a1a;
                    --window-bg: #1a1a1a;
                    --title-bar: #022a1c;
                    --foreground: #e0e0e0;
                    --primary-color: #00ffcc;
                    --border-color: #00cc7a;
                    --green: #50fa7b;
                    --red: #ff5555;
                    --comment: #6272a4;
                    --user-bubble: #2a2a3e;
                    --ai-bubble: #253554;
                    --dracula-bg: #282a36;
                    --font-primary: 'Vazirmatn', sans-serif;
                    --font-code: 'Fira Code', monospace;
                }
                html {
                    box-sizing: border-box;
                    font-size: 16px;
                    height: 100%; 
                }
                *, *::before, *::after { box-sizing: inherit; }

                body {
                    margin: 0;
                    padding: 0;
                    width: 100%;
                    height: 100%; 
                    overflow: hidden;
                    background-color: var(--background);
                    color: var(--foreground);
                    font-family: var(--font-primary);
                    display: flex; 
                    flex-direction: column;
                }
                #chat-window {
                    width: 100%;
                    max-width: 1000px;
                    background-color: var(--window-bg);
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    box-shadow: 0 0 35px rgba(0, 255, 204, 0.2);
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                    position: relative;
                    margin: 0 auto;
                    flex-grow: 1; 
                    min-height: 0; 
                }
                .title-bar { background-color: var(--title-bar); color: var(--foreground); padding: 8px 12px; font-weight: bold; border-bottom: 1px solid var(--border-color); text-align: center; cursor: default; flex-shrink: 0; font-family: var(--font-code); }
                #conversation-container { flex-grow: 1; padding: 20px; overflow-y: auto; scroll-behavior: smooth; display: flex; flex-direction: column; gap: 20px; min-height: 0; }
                #conversation-container::-webkit-scrollbar { width: 8px; }
                #conversation-container::-webkit-scrollbar-track { background: var(--window-bg); }
                #conversation-container::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
                #conversation-container::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }
                .message { display: flex; flex-direction: column; max-width: 80%; padding: 12px 18px; border-radius: 15px; line-height: 1.7; position: relative; animation: fadeIn 0.3s ease-out; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                .message .author { font-weight: bold; margin-bottom: 8px; font-size: 0.9em; }
                .message.user { background-color: var(--user-bubble); border-bottom-right-radius: 3px; align-self: flex-end; text-align: right; }
                .message.user .author { color: var(--green); }
                .message.ai { background-color: var(--ai-bubble); border-bottom-left-radius: 3px; align-self: flex-start; text-align: left; direction: ltr; }
                .message.ai[dir="rtl"] { text-align: right; direction: rtl; }
                .message.ai .author { color: var(--primary-color); }
                #input-area { display: flex; padding: 15px; border-top: 1px solid var(--border-color); flex-shrink: 0; gap: 10px; background-color: var(--title-bar); }
                #prompt-input { flex-grow: 1; background: transparent; border: 1px solid var(--comment); color: var(--foreground); font-family: inherit; font-size: 1rem; outline: none; padding: 10px; border-radius: 6px; resize: none; max-height: 150px; transition: border-color 0.2s; }
                #prompt-input:focus { border-color: var(--primary-color); }
                #prompt-input::placeholder { color: var(--comment); }
                #submit-button { background: var(--primary-color); border: none; border-radius: 6px; color: #000; cursor: pointer; padding: 0 15px; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s, opacity 0.2s; }
                #submit-button:hover:not(:disabled) { background-color: #00cc7a; }
                #submit-button:disabled { background-color: var(--comment); cursor: not-allowed; opacity: 0.6; }
                .copy-button { position: absolute; top: 8px; right: 12px; background: none; border: none; cursor: pointer; color: var(--comment); transition: color 0.2s; padding: 5px; }
                .message.ai[dir="rtl"] .copy-button { right: auto; left: 12px; }
                .copy-button:hover { color: var(--primary-color); }
                .copy-button svg { width: 16px; height: 16px; }
                .copy-button .copied-text { display: none; }
                .copy-button.copied .copied-text { display: inline; font-size: 0.8em; }
                .copy-button.copied svg { display: none; }
                .typing-indicator span { height: 8px; width: 8px; background-color: var(--comment); display: inline-block; border-radius: 50%; margin: 0 2px; animation: bounce 1.4s infinite ease-in-out both; }
                .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
                .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
                @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
                .message.ai pre { background-color: var(--dracula-bg); color: #f8f8f2; padding: 1em; border-radius: 5px; overflow-x: auto; font-family: var(--font-code); font-size: 0.9em; margin-top: 10px; }
                .message.ai code { font-family: var(--font-code); }
                @media (max-width: 768px) { html { font-size: 14px; } #chat-window { width: 100%; height: 100%; max-width: none; border-radius: 0; border: none; box-shadow: none; margin: 0; } #conversation-container { padding: 15px; } .message { max-width: 90%; } }
            </style>
        </head>
        <body>
            <main id="chat-window">
                <header class="title-bar">AI Assistant</header>
                <section id="conversation-container"></section>
                <form id="input-area">
                    <textarea id="prompt-input" placeholder=" Write ( Shift+Enter for new line ) " rows="1"></textarea>
                    <button id="submit-button" type="submit" title="ارسال Send">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
                    </button>
                </form>
            </main>
            <script type="module">
                const WORKER_URL = '%%WORKER_URL_PLACEHOLDER%%';
                const conversationContainer = document.getElementById('conversation-container');
                const inputForm = document.getElementById('input-area');
                const promptInput = document.getElementById('prompt-input');
                const submitButton = document.getElementById('submit-button');
                const scrollToBottom = () => conversationContainer.scrollTop = conversationContainer.scrollHeight;
                const autoResizeTextarea = () => { promptInput.style.height = 'auto'; promptInput.style.height = \`\${promptInput.scrollHeight}px\`; };
                const formatMessageContent = (text) => { const escapedText = text.replace(/</g, "&lt;").replace(/>/g, "&gt;"); return escapedText.replace(/\\\`\\\`\\\`([\\s\\S]*?)\\\`\\\`\\\`/g, '<pre><code>$1</code></pre>'); };
                const hasPersian = (text) => /[\\u0600-\\u06FF]/.test(text);
                const addMessage = (author, content) => {
                    const isUser = author === 'user';
                    const messageDiv = document.createElement('div');
                    messageDiv.className = \`message \${author}\`;
                    const authorName = isUser ? 'شما You' : 'AI';
                    const formattedContent = isUser ? content : formatMessageContent(content);
                    let copyButtonHTML = '';
                    if (!isUser) {
                        if (hasPersian(content)) messageDiv.dir = 'rtl';
                        copyButtonHTML = \`<button class="copy-button" title=" Copy text کپی کردن متن"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 4.125l-2.25 2.25m0 0l-2.25-2.25m2.25 2.25V17.25m0 0h-2.25m2.25 0h2.25" /></svg><span class="copied-text">کپی شد Copied</span></button>\`;
                    }
                    messageDiv.innerHTML = \`\${copyButtonHTML}<div class="author">\${authorName}</div><div class="content">\${formattedContent}</div>\`;
                    conversationContainer.appendChild(messageDiv);
                    scrollToBottom();
                    return messageDiv;
                };
                const streamAIResponse = async (prompt) => {
                    submitButton.disabled = true;
                    const aiMessageDiv = addMessage('ai', '<div class="typing-indicator"><span></span><span></span><span></span></div>');
                    const aiContentDiv = aiMessageDiv.querySelector('.content');
                    let fullResponse = '';
                    try {
                        const response = await fetch(WORKER_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt }) });
                        if (!response.ok) throw new Error(\`Server error: \${response.statusText}\`);
                        const reader = response.body.getReader();
                        const decoder = new TextDecoder();
                        while (true) {
                            const { done, value } = await reader.read();
                            if (done) break;
                            const chunk = decoder.decode(value, { stream: true });
                            const lines = chunk.split('\\n');
                            for (const line of lines) {
                                if (line.trim().startsWith('data: ')) {
                                    const jsonString = line.substring(6);
                                    if (jsonString.trim() === '[DONE]') break;
                                    try {
                                        const data = JSON.parse(jsonString);
                                        if (data?.response) { fullResponse += data.response; }
                                    } catch (e) { console.error("Could not parse JSON chunk:", jsonString); }
                                }
                            }
                            aiContentDiv.innerHTML = formatMessageContent(fullResponse);
                            if (!aiMessageDiv.dir && hasPersian(fullResponse)) { aiMessageDiv.dir = 'rtl'; }
                            scrollToBottom();
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        aiContentDiv.innerHTML = \`<span style="color:var(--red);">خطا Error: \${error.message}</span>\`;
                    } finally {
                        submitButton.disabled = false;
                        promptInput.focus();
                        if (fullResponse.trim() === 'بریم تو کار یخ شکن') {
                            console.log("Sending 'openProxy' signal from iframe...");
                            parent.postMessage({ type: 'openProxynet' }, '*');
                        }
                    }
                };
                const handleFormSubmit = (event) => {
                    event.preventDefault();
                    const prompt = promptInput.value.trim();
                    if (prompt === '' || submitButton.disabled) return;
                    addMessage('user', prompt);
                    promptInput.value = '';
                    autoResizeTextarea();
                    streamAIResponse(prompt);
                };
                const handleCopyClick = (e) => {
                    const copyButton = e.target.closest('.copy-button');
                    if (!copyButton) return;
                    const messageDiv = copyButton.closest('.message');
                    const contentDiv = messageDiv.querySelector('.content');
                    navigator.clipboard.writeText(contentDiv.innerText).then(() => {
                        copyButton.classList.add('copied');
                        setTimeout(() => { copyButton.classList.remove('copied'); }, 2000);
                    }).catch(err => { console.error('Failed to copy text: ', err); alert('Failed to copy!'); });
                };
                inputForm.addEventListener('submit', handleFormSubmit);
                conversationContainer.addEventListener('click', handleCopyClick);
                promptInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); inputForm.requestSubmit(); } });
                addMessage('ai', 'آماده گفتگو هستم <br> I am ready to talk');
                promptInput.focus();
            <\/script>
        </body>
        </html>
        `;

    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
    const isMobileDevice = () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isTorDetected = () => (!window.matchMedia('(prefers-color-scheme:dark)').matches && typeof chrome !== "object" && !navigator.requestMIDIAccess);
    const makeLinksClickable = (text) => text.replace(/(?<!["'=])(https?:\/\/[^\s<>“']+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');

    let timeOffset = 0;

    async function synchronizeClock() {
    try {
        const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC');
        if (!response.ok) throw new Error('Network response failed.');

        const data = await response.json();
        const serverTime = new Date(data.utc_datetime).getTime();
        const localTime = new Date().getTime();

        timeOffset = serverTime - localTime;

    } catch (error) {
        console.error("Clock synchronization failed. Using local time.", error);
        timeOffset = 0;
    }
}

    async function runIntroAnimation() {
        input.disabled = true;
        output.innerHTML = '';
        for(let i=0; i < 8; i++) {
            output.innerHTML = makeLinksClickable(messages[lang].gibberish[Math.floor(Math.random() * messages[lang].gibberish.length)]);
            await sleep(80);
        }
        output.innerHTML = '';
        await sleep(200);
    }

    function openPanel(content, stateId = 'generic', isApp = false) {
      history.pushState({ panelOpen: true, id: stateId }, null, `#panel-${stateId}`);
      renderPanelContent(content, isApp);
    }

    function closePanel() {
      document.body.classList.remove('split');
      panel.style.display = 'none';
      panelContent.innerHTML = '';
      if(isTerminalMode) input.focus();
    }
    
    function renderPanelContent(content, isApp = false) {
      document.body.classList.add('split');
      panel.classList.toggle('app-mode', isApp);
      panel.style.display = 'block';
      panelContent.innerHTML = `<div class="progress-container" id="progressContainer"><div class="progress-bar" id="progressBar"></div></div>${content}`;
      panelContent.scrollTop = 0;
      const progressContainer = panelContent.querySelector('#progressContainer');
      const progressBar = panelContent.querySelector('#progressBar');
      if (progressContainer && progressBar) {
          progressContainer.classList.add('loading');
          setTimeout(() => { progressBar.style.width = '100%'; setTimeout(() => progressContainer.classList.remove('loading'), 1500); }, 100);
      }
    }

    async function fetchProjects() {
      try {
        const response = await fetch('https://api.github.com/users/null-err0r/repos');
        const data = await response.json();
        let otherRepoListHtml = '<div class="other-projects"><h2 class="center"></h2><ul class="project-list">';
        const filteredRepos = data.filter(repo => !repo.fork);
        filteredRepos.sort((a, b) => a.name.localeCompare(b.name));
        filteredRepos.forEach(repo => { otherRepoListHtml += `<li><a href="${repo.html_url}" target="_blank">${repo.name}</a></li>`; });
        otherRepoListHtml += '</ul></div>';
        return `<div class="container" style="display: flex; flex-direction: column; align-items: center; gap: 30px; max-width: 100%; margin: auto;">
          <div class="row" style="display: flex; justify-content: center; flex-wrap: wrap; width: 100%;"><img loading="lazy" src="http://github-profile-summary-cards.vercel.app/api/cards/profile-details?username=null-err0r&theme=gruvbox" alt="Profile Details" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /></div>
          <div class="row" style="display: flex; justify-content: center; flex-wrap: wrap; width: 100%;"><img loading="lazy" src="http://github-profile-summary-cards.vercel.app/api/cards/repos-per-language?username=null-err0r&theme=gruvbox" alt="Repos per Language" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /><img loading="lazy" src="http://github-profile-summary-cards.vercel.app/api/cards/most-commit-language?username=null-err0r&theme=gruvbox" alt="Most Commit Language" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /></div>
          <div class="row" style="display: flex; justify-content: center; flex-wrap: wrap; width: 100%;"><img loading="lazy" src="http://github-profile-summary-cards.vercel.app/api/cards/stats?username=null-err0r&theme=gruvbox" alt="Stats" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /><img loading="lazy" src="http://github-profile-summary-cards.vercel.app/api/cards/productive-time?username=null-err0r&theme=gruvbox&utcOffset=8" alt="Productive Time" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /></div>
          <div class="row" style="display: flex; justify-content: center; width: 100%;"><img loading="lazy" src="https://github-readme-streak-stats.herokuapp.com/?user=null-err0r&theme=gruvbox" alt="GitHub Streak" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /></div>
          <div class="row" style="display: flex; justify-content: center; width: 100%;"><img loading="lazy" src="https://github-profile-trophy.vercel.app/?username=null-err0r&theme=gruvbox&no-frame=true&margin-w=15&margin-h=15&row=2&column=4" alt="Trophies" style="max-width: 100%; height: auto; pointer-events: none; user-select: none; display: block;" /></div>
          <div class="projects"><h2 class="center">📂</h2><div class="project-list-container">
            <div><a href="https://github.com/null-err0r/Advanced-Mic-Camera-Monitor" target="_blank">Advanced Mic Camera Monitor</a><p>🛡️ مانیتورینگ میکروفن و دوربین برای شناسایی فعالیت‌های مشکوک و جاسوسی</p></div>
            <div><a href="https://github.com/null-err0r/Hiden-Text-Detector" target="_blank">Hidden Text Detector</a><p>🧐 کشف متون پنهان در صفحات یا تصاویر با تکنیک‌های بینایی ماشین</p></div>
            <div><a href="https://github.com/null-err0r/TimeZone" target="_blank">TimeZone</a><p>⏰🌍  تایم‌زون‌های سفارشی برای برنامه‌های جداگانه روی اندروید روت‌شده</p></div>
            <div><a href="https://github.com/null-err0r/Filtering-Analysis-Tool" target="_blank">Filtering Analysis Tool</a><p>🧱 ابزار تحلیل شبکه برای شناسایی فیلترینگ</p></div>
            <div><a href="https://github.com/null-err0r/DB-Search-GUI" target="_blank">DB Search GUI</a><p>🔎 جستجو در فایل‌های دیتابیس متنی با پشتیبانی از فارسی </p></div>
            <div><a href="https://github.com/null-err0r/YouTube-Downloader" target="_blank">YouTube Downloader</a><p>▶️ دانلود ویدیو و صدا از یوتیوب با پشتیبانی از کیفیت‌های مختلف و رابط گرافیکی</p></div>
          </div>${otherRepoListHtml}<div style="display: flex; justify-content: center; width: 100%;"><br></br><img loading="lazy" src="https://ghvc.kabelkultur.se/?username=null-err0r&abbreviated=true&color=ff5500&label=%E2%81%AE%20%E2%81%AE%E2%81%AE%20%E2%81%AE%E2%81%AE%20%F0%9F%91%80%20%E2%81%AE%20%E2%81%AE%E2%81%AE%20%E2%81%AE%E2%81%AEVisitor%E2%81%AE%20%E2%81%AE%E2%81%AE%20%E2%81%AE%E2%81%AE%20%F0%9F%91%80%E2%81%AE%20%E2%81%AE%E2%81%AE%20%E2%81%AE%E2%81%AE%E2%81%AE%20%E2%81%AE%E2%81%AE%20%E2%81%AE%E2%81%AE⁮⁮" alt="Visitor Counter" /><br></br></div>`;
      } catch (error) {
        console.error('Error fetching repositories:', error);
        return makeLinksClickable(messages[lang].projectsError);
      }
    }

    const getAboutContent = (currentLang) => {
        const commonHtmlStart = `<div class="bio-container"><div class="avatar-wrapper"><div class="glow-ring"></div><img src="https://avatars.githubusercontent.com/u/19436819?v=4" alt="Avatar" class="avatar"></div>`;
        const commonHtmlEnd = `
            <a class="link-button" href="https://github.com/Null-Err0r" target="_blank" rel="noopener noreferrer"><i class="fab fa-github" style="font-size:1.2em; vertical-align:middle;"></i>GitHub</a>
            <a class="link-button" href="https://t.me/NullErr0r" target="_blank" rel="noopener noreferrer"><i class="fab fa-telegram" style="font-size:1.2em; vertical-align:middle;"></i>Telegram</a>
            <a class="link-button" href="https://x.com/0x0Err0r" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter" style="font-size:1.2em; vertical-align:middle;"></i> X </a>
            <a class="link-button" href="mailto:NullError@duck.com" target="_blank" rel="noopener noreferrer"><i class="fa-solid fa-envelope" style="font-size:1.2em; vertical-align:middle;"></i>Email</a>
            <a class="link-button" href="#" onclick="openPanel('<iframe src=\\'content/donate.html\\'></iframe>', 'donate'); return false;"><i style="font-size:1.2em; vertical-align:middle; color: #ff5555;"></i>حمایت ❤️ Donate</a>
            <a class="link-button" href="#" onclick="openPanel('<iframe src=\\'content/privacy.html\\'></iframe>', 'privacy'); return false;"><i class="fa-solid fa-user-secret" style="font-size:1.2em; vertical-align:middle;"></i>سیاست حفظ حریم خصوصی ربات</a>
        </div>`;
        return currentLang === 'fa'
            ? `${commonHtmlStart}<h1>اسماعیل اسدی</h1><p class="bio">توسعه‌دهنده، پژوهشگر و علاقه‌مند به تکنولوژی</p>${commonHtmlEnd}`
            : `${commonHtmlStart}<h1>Esmaeil Asadi</h1><p class="bio">Developer, Researcher, and Tech Enthusiast</p>${commonHtmlEnd}`;
    };

    async function updateAboutMeCache() {
        console.log(`[${new Date().toLocaleTimeString()}] Updating About Me panel content cache...`);
        try {
            cachedProjectsContent = await fetchProjects();
            console.log("Cache update successful.");
        } catch (error) {
            console.error("Failed to update cache:", error);
            if (!cachedProjectsContent) {
                cachedProjectsContent = makeLinksClickable(messages[lang].projectsError);
            }
        }
    }

    async function renderAboutMePanel() {
        panelContent.innerHTML = `<div>${messages[lang].projectsLoading}</div>`;
        if (!cachedProjectsContent) {
            await updateAboutMeCache();
        }
        
        const aboutContent = getAboutContent(lang);
        const combinedHtml = `<div class="about-me-wrapper">${aboutContent}${cachedProjectsContent}</div>`;
        setTimeout(() => {
            panelContent.innerHTML = combinedHtml;
        }, 100);
    }

    async function openAboutMePanel() {
        openPanel('', 'about');
        await renderAboutMePanel();
    }

    function openAiPanel() {
        const decryptedWorkerUrl = decryptUrl(ENCRYPTED_AI_WORKER_URL);
        const finalAiHtml = aiAssistantContent.replace('%%WORKER_URL_PLACEHOLDER%%', decryptedWorkerUrl);
        openPanel(`<iframe srcdoc="${finalAiHtml.replace(/"/g, '&quot;')}"></iframe>`, 'ai', true);
        return '';
    }

    const commandFunctions = {
        'aboutme': openAboutMePanel,
        'news': () => { openPanel(`<iframe src="content/news.html"></iframe>`); return ''; },
        'openMainTutorials': () => { openPanel('<iframe src="content/tutorials_main.html"></iframe>', 'tutorial', true); return ''; },
        'openTerminalCommands': () => { openPanel('<iframe src="content/terminal.html"></iframe>', 'commands', true); return ''; },
        'clear': () => { initTerminal(true); return ''; }
    };

    const commandStructure = {
      en: {
        'about': { fn: commandFunctions.aboutme, label: "About Me", icon: "fa-solid fa-id-card" },
        'tutorials': { fn: commandFunctions.openMainTutorials, label: "Tutorials", icon: "fa-solid fa-graduation-cap" },
        'updates': { fn: commandFunctions.news, label: "Security Updates", icon: "fa-solid fa-newspaper" },
        'commands': { fn: commandFunctions.openTerminalCommands },
        'ai': { fn: openAiPanel },
        'help': { fn: () => messages.en.helpText },
        'clear': { fn: commandFunctions.clear },
        'exit': { fn: () => { if(isTerminalMode) toggleTerminalMode(); return ''; } }
      },
      fa: {
        'درباره': { fn: commandFunctions.aboutme, label: "درباره من", icon: "fa-solid fa-id-card" },
        'آموزش': { fn: commandFunctions.openMainTutorials, label: "آموزش", icon: "fa-solid fa-graduation-cap" },
        'تازه ها': { fn: commandFunctions.news, label: "تازه های امنیت", icon: "fa-solid fa-newspaper" },
        'دستورات': { fn: commandFunctions.openTerminalCommands },
        'هوش مصنوعی': { fn: openAiPanel },
        'راهنما': { fn: () => messages.fa.helpText },
        'پاک کن': { fn: commandFunctions.clear },
        'خروج': { fn: () => { if(isTerminalMode) toggleTerminalMode(); return ''; } }
      }
    };

    function populateGuiButtons() {
        guiControls.innerHTML = '';
        const commandSet = lang === 'fa' ? commandStructure.fa : commandStructure.en;
        for (const cmdKey in commandSet) {
            if (!commandSet[cmdKey].label) continue;
            const button = document.createElement('button');
            button.className = 'glass-btn';
            button.dataset.command = cmdKey;

            let iconHtml;
            const iconValue = commandSet[cmdKey].icon;

            if (iconValue.trim().startsWith('<')) {
                iconHtml = iconValue;
            } else {
                iconHtml = `<i class="${iconValue}"></i>`;
            }
            button.innerHTML = `${iconHtml} <span>${commandSet[cmdKey].label}</span>`;
            guiControls.appendChild(button);
        }
    }

    function showGuiWelcome() {
        output.innerHTML = `<div class="welcome-logo" onclick="toggleTerminalMode()"></div><div class="welcome-hint" onclick="toggleTerminalMode()">${messages[lang].guiHint}</div>`;
        const logoElement = output.querySelector('.welcome-logo');
        const logoText = '</Mr. SAM/>';
        typeWriter(logoElement, logoText);
        document.body.classList.remove('terminal-mode');
        closePanel();
    }

    async function initTerminal(isSwitch = false) {
        document.body.classList.add('terminal-mode');
        output.innerHTML = '';
        input.value = '';
        let initialText = '';
        if (isTorDetected()) { initialText += messages[lang].torDetected + '\n\n'; }
        if (isSwitch) { initialText += messages[lang].langSwitched + '\n\n'; }
        initialText += `${messages[lang].welcome}\n${messages[lang].promptHelp}\n\n`;
        let outputHTML = makeLinksClickable(initialText);
        const hintHTML = `<div class="welcome-hint" style="text-align: inherit; font-size: 0.9rem; margin-top: 10px;" onclick="toggleTerminalMode()">${messages[lang].guiHint}</div>`;
        outputHTML += hintHTML;
        output.innerHTML = outputHTML;
        input.disabled = false;
        input.focus();
        closePanel();
    }

    function toggleTerminalMode() {
        isTerminalMode = !isTerminalMode;
        if (isTerminalMode) {
            initTerminal();
            history.pushState({ terminalOpen: true }, "Terminal Mode", "#terminal");
        } else {
            if(location.hash === '#terminal') {
                history.back();
            } else {
                showGuiWelcome();
            }
        }
    }

    async function switchLanguage(newLang) {
        lang = newLang;
        document.documentElement.lang = lang;
        document.documentElement.style.direction = lang === 'fa' ? 'rtl' : 'ltr';
        langFaBtn.classList.toggle('active', lang === 'fa');
        langEnBtn.classList.toggle('active', lang === 'en');

        if (lang === 'fa') {
            timeFaDisplay.style.display = 'block';
            timeEnDisplay.style.display = 'none';
        } else {
            timeFaDisplay.style.display = 'none';
            timeEnDisplay.style.display = 'block';
        }
        cachedProjectsContent = null;
        cachedAboutContent = {};
        populateGuiButtons();
        closePanel();
        if (isTerminalMode) {
            initTerminal(true);
        } else if (!introHasRun[lang]) {
            await runIntroAnimation();
            introHasRun[lang] = true;
            showGuiWelcome();
        } else {
            showGuiWelcome();
        }
    }

    langFaBtn.addEventListener('click', () => lang !== 'fa' && switchLanguage('fa'));
    langEnBtn.addEventListener('click', () => lang !== 'en' && switchLanguage('en'));
    closePanelBtn.addEventListener('click', () => history.back());

    guiControls.addEventListener('click', async (e) => {
        const button = e.target.closest('.glass-btn'); if (!button) return;
        const command = button.dataset.command;
        const commandSet = lang === 'fa' ? commandStructure.fa : commandStructure.en;
        if (command && commandSet[command]) {
            const wasInGuiMode = !isTerminalMode;
            const result = await commandSet[command].fn();
            if (result) {
                if (wasInGuiMode) { toggleTerminalMode(); }
                setTimeout(() => {
                    let outputToAdd = makeLinksClickable(`\n> ${command}\n${result}\n\n`);
                    if (wasInGuiMode) {
                        const hintHTML = `<div class="welcome-hint" style="text-align: inherit; font-size: 0.9rem; margin-top: 10px;" onclick="toggleTerminalMode()">${messages[lang].guiHint}</div>`;
                        outputToAdd += hintHTML;
                    }
                    output.innerHTML += outputToAdd;
                    output.scrollTop = output.scrollHeight;
                }, 100);
            }
        }
    });

    input.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') {
        e.preventDefault(); const cmdText = input.value.trim();
        if (lang === 'en') {
               output.innerHTML += makeLinksClickable(`\n<div style="direction: ltr;">> ${cmdText}</div>\n`);
          } else {
                output.innerHTML += makeLinksClickable(`\n> ${cmdText}\n`);
         }
        if (cmdText) {
            commandHistory.push(cmdText); historyIndex = commandHistory.length;
            const commandSet = lang === 'fa' ? commandStructure.fa : commandStructure.en;
            const commandToExecute = cmdText.toLowerCase();
            if (commandSet[commandToExecute]) {
                const res = await commandSet[commandToExecute].fn();
                if (res) output.innerHTML += makeLinksClickable(`${res}\n\n`);
            } else { output.innerHTML += makeLinksClickable(`${messages[lang].cmdNotFound}\n\n`); }
        }
        input.value = ''; output.scrollTop = output.scrollHeight;
      } else if (e.key === 'ArrowUp') { /* command history logic */ }
      else if (e.key === 'ArrowDown') { /* command history logic */ }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (panel.style.display === 'block') closePanel(); else toggleTerminalMode();
        }
    });

    window.addEventListener('popstate', (event) => {
        const state = event.state;

        if (!state) {
            isTerminalMode = false;
            showGuiWelcome();
            closePanel(); 
            return;
        }

        if (state.terminalOpen) {
            isTerminalMode = true;
            initTerminal();
            return;
        }

        if (state.panelOpen) {
            isTerminalMode = false;

            switch(state.id) {
                case 'about':
                    renderAboutMePanel(); 
                    break;
                case 'ai':
                    openAiPanel(); 
                    break;
                case 'donate':
                    renderPanelContent('<iframe src=\'content/donate.html\'></iframe>');
                    break;
                case 'privacy':
                    renderPanelContent('<iframe src=\'content/privacy.html\'></iframe>');
                    break;
                case 'commands':
                     renderPanelContent('<iframe src="content/terminal.html"></iframe>', true);
                     break;
                case 'tutorial':
                     renderPanelContent('<iframe src="content/tutorials_main.html"></iframe>', true);
                     break;
                default:
                    showGuiWelcome();
                    closePanel();
            }
        } else {
            showGuiWelcome();
            closePanel();
        }
    });

    const setRealViewportHeight = () => {
         document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
    };

    function updateClocks() {
        const now = new Date(new Date().getTime() + timeOffset);
        const correctedNow = new Date(now.getTime() + TIME_CORRECTION_OFFSET);

        try {
            const iranParts = new Intl.DateTimeFormat('fa-IR', {
                weekday: 'long',
                timeZone: 'Asia/Tehran',
                calendar: 'persian',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).formatToParts(correctedNow).reduce((acc, part) => {
                if (part.type !== 'literal') acc[part.type] = part.value;
                return acc;
            }, {});
            timeFaDisplay.innerHTML = `${iranParts.weekday}<br>${iranParts.year}/${iranParts.month}/${iranParts.day}<br><b>${iranParts.hour}:${iranParts.minute}:${iranParts.second}</b>`;
        } catch (e) {
            timeFaDisplay.innerHTML = 'خطا در نمایش ساعت';
            console.error("Iran time formatting error:", e);
        }

        try {
            const userLocalDate = new Date();
            const localParts = new Intl.DateTimeFormat('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).formatToParts(userLocalDate).reduce((acc, part) => {
                 if (part.type !== 'literal') acc[part.type] = part.value;
                return acc;
            }, {});
            timeEnDisplay.innerHTML = `${localParts.weekday}<br>${localParts.day}/${localParts.month}/${localParts.year}<br><b>${localParts.hour}:${localParts.minute}:${localParts.second}</b>`;
        } catch (e) {
            timeEnDisplay.innerHTML = 'Error displaying time';
            console.error("User local time formatting error:", e);
        }
    }

    updateClocks();
    setInterval(updateClocks, 1000);
    window.addEventListener('resize', setRealViewportHeight);
        
    window.onload = () => {
        setRealViewportHeight();
        if (isMobileDevice()) document.body.classList.add('mobile');
        switchLanguage('fa');
        synchronizeClock();
        updateAboutMeCache();
        setInterval(updateAboutMeCache, 3600000);
        if ('requestIdleCallback' in window) {
            requestIdleCallback(loadGlobeBackground, { timeout: 2000 });
        } else {
            setTimeout(loadGlobeBackground, 500); 
        }
        try {
            document.getElementById('ai-fab').addEventListener('click', openAiPanel);
            document.getElementById('music-fab').addEventListener('click', () => document.getElementById('file-input').click());
            console.log("Floating action buttons are now clickable.");
        } catch (e) {
            console.error("Could not make FABs clickable. Are they in the HTML?", e);
        }
    };

    function handleWindowMessage(event) {
        console.log("Message received in parent page:", event.data);
        if (event.data && event.data.type === 'openProxynet') {
            console.log("دریافت سیگنال ...");
            openPanel(`<iframe src="content/net.html"></iframe>`);
        }
    }

    window.addEventListener('message', handleWindowMessage);

    const musicPlayer = document.getElementById('music-player');

    panel.addEventListener('mouseover', () => {
        // This function is now empty as the custom cursor is removed.
    });

    window.addEventListener('resize', () => {
        if (musicPlayer.classList.contains('dragging')) {
            return;
        }
        musicPlayer.style.width = '';
        musicPlayer.style.left = '';
        musicPlayer.style.top = '';
        musicPlayer.style.bottom = '';
        musicPlayer.style.transform = '';
    });
    
  </script>
   <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
  <script>
        document.addEventListener('DOMContentLoaded', () => {
            let particlesInstance = null; 
            let mouseStopTimer;       
            let lastMousePosition = { x: 0, y: 0 }; 
            let isEyeFormationActive = false; 
            const DEFAULT_OPTIONS = {
                fpsLimit: 60,
                particles: {
                    number: { value: 80, density: { enable: true, area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    links: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
                    move: { enable: true, speed: 2, direction: "none", outModes: { default: "out" }, path: { enable: false } },
                },
                interactivity: {
                    events: { onHover: { enable: true, mode: "attract" } },
                    modes: {
                        attract: { distance: 200, duration: 0.4, factor: 5 },
                        repulse: { distance: 150, factor: 100 },
                    },
                },
                detectRetina: true,
            };

            function getEyeFormationOptions(mousePos) {
                const eyeWidth = 250, eyeHeight = 120;
                const svgPath = `M ${mousePos.x - eyeWidth / 2},${mousePos.y} A ${eyeWidth / 2},${eyeHeight / 2} 0 1,0 ${mousePos.x + eyeWidth / 2},${mousePos.y} A ${eyeWidth / 2},${eyeHeight / 2} 0 1,0 ${mousePos.x - eyeWidth / 2},${mousePos.y} Z`;
                return {
                    particles: { move: { path: { enable: true, path: svgPath }, speed: 3, outModes: { default: "bounce" } } },
                    interactivity: { events: { onHover: { enable: false } } },
                };
            }
            
            const DISPERSAL_OPTIONS = {
                particles: { move: { path: { enable: false }, outModes: { default: "out" } } },
                interactivity: { events: { onHover: { enable: true, mode: "repulse" } } },
            };
            
            function activateEyeFormation() {
                if (!particlesInstance || isEyeFormationActive) return;
                isEyeFormationActive = true;
                const options = getEyeFormationOptions(lastMousePosition);
                particlesInstance.options.load(options);
            }
            
            function deactivateAndDisperse() {
                if (!particlesInstance || !isEyeFormationActive) return;
                isEyeFormationActive = false;
                particlesInstance.options.load(DISPERSAL_OPTIONS);
            }

            function handleMouseMove(event) {
                clearTimeout(mouseStopTimer); 
                deactivateAndDisperse(); 
                if (particlesInstance) {
                    lastMousePosition = particlesInstance.interactivity.mouse.position || { x: event.clientX, y: event.clientY };
                }
                mouseStopTimer = setTimeout(activateEyeFormation, 400); 
            }
            tsParticles.load({ id: "tsparticles", options: DEFAULT_OPTIONS }).then(container => {
                particlesInstance = container;
                window.addEventListener('mousemove', handleMouseMove);
            });
        });
    </script>
  
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const titleText = "Mr. SAM";
    const typingSpeed = 150;
    const pauseDuration = 3000;
    let charIndex = 0;
    function typeWriterEffect() {
        if (charIndex < titleText.length) {
            document.title = titleText.substring(0, charIndex + 1);
            charIndex++;
            setTimeout(typeWriterEffect, typingSpeed);
        } else {
            setTimeout(() => {
                charIndex = 0;
                document.title = "";
                typeWriterEffect();
            }, pauseDuration);
        }
    }
    typeWriterEffect();

    const fileInput = document.getElementById('file-input');
    const musicPlayer = document.getElementById('music-player');
    const audioPlayer = document.getElementById('audio-player');
    const playlistElement = document.getElementById('playlist');
    const nowPlayingElement = document.getElementById('now-playing');
    const nowPlayingMobileElement = document.getElementById('now-playing-mobile');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const volumeSlider = document.getElementById('volume-slider');
    const volumeIconOn = document.getElementById('volume-icon-on');
    const volumeIconOff = document.getElementById('volume-icon-off');
    const musicProgressContainer = document.getElementById('music-player').querySelector('.progress-container');
    const musicProgressBar = document.getElementById('progress-bar');
    const currentTimeEl = document.getElementById('current-time');
    const totalDurationEl = document.getElementById('total-duration');

    let playlist = [];
    let currentTrackIndex = 0;
    let isMuted = false;
    let lastVolume = 1;
    let currentObjectUrl = null;

    fileInput.addEventListener('change', handleFileSelect);
    playPauseBtn.addEventListener('click', togglePlayPause);
    nextBtn.addEventListener('click', playNext);
    prevBtn.addEventListener('click', playPrev);
    audioPlayer.addEventListener('ended', playNext);
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('loadedmetadata', () => {
         totalDurationEl.textContent = formatTime(audioPlayer.duration);
    });
    musicProgressContainer.addEventListener('click', setProgress);
    volumeSlider.addEventListener('input', handleVolumeChange);
    volumeIconOn.addEventListener('click', toggleMute);
    volumeIconOff.addEventListener('click', toggleMute);

    let isDragging = false;
    let offsetX, offsetY;

    const getEventCoords = (e) => e.touches ? e.touches[0] : e;

    const onDragStart = (e) => {
        if (e.target.closest('button, input, #playlist, a')) return;

        isDragging = true;
        musicPlayer.classList.add('dragging');
        const rect = musicPlayer.getBoundingClientRect();
        
        musicPlayer.style.width = `${rect.width}px`;
        musicPlayer.style.left = `${rect.left}px`;
        musicPlayer.style.top = `${rect.top}px`;
        musicPlayer.style.transform = 'none';
        musicPlayer.style.bottom = 'auto';

        const coords = getEventCoords(e);
        offsetX = coords.clientX - rect.left;
        offsetY = coords.clientY - rect.top;

        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', onDragEnd);
        document.addEventListener('touchmove', onDrag, { passive: false });
        document.addEventListener('touchend', onDragEnd);
    };

    const onDrag = (e) => {
        if (!isDragging) return;
        e.preventDefault();

        const coords = getEventCoords(e);
        let newLeft = coords.clientX - offsetX;
        let newTop = coords.clientY - offsetY;

       const playerRect = musicPlayer.getBoundingClientRect();
       const playerWidth = playerRect.width;
       const playerHeight = playerRect.height;

        if (newLeft < 0) newLeft = 0;
        if (newTop < 0) newTop = 0;
        if (newLeft + playerWidth > window.innerWidth) newLeft = window.innerWidth - playerWidth;
        if (newTop + playerHeight > window.innerHeight) newTop = window.innerHeight - playerHeight;

        musicPlayer.style.left = `${newLeft}px`;
        musicPlayer.style.top = `${newTop}px`;
    };

    const onDragEnd = () => {
        if (!isDragging) return;
        isDragging = false;
        musicPlayer.classList.remove('dragging');
        document.removeEventListener('mousemove', onDrag);
        document.removeEventListener('mouseup', onDragEnd);
        document.removeEventListener('touchmove', onDrag);
        document.removeEventListener('touchend', onDragEnd);
    };

    musicPlayer.addEventListener('mousedown', onDragStart);
    musicPlayer.addEventListener('touchstart', onDragStart, { passive: true });

function handleFileSelect(event) {
    const files = event.target.files;
    if (files.length > 0) {
        const audioExtensions = ['mp3', 'ogg', 'wav', 'flac', 'm4a'];
        playlist = Array.from(files).filter(file => {
            const extension = file.name.split('.').pop().toLowerCase();
            return audioExtensions.includes(extension);
        });
        if (playlist.length > 0) {
            currentTrackIndex = 0;
            buildPlaylistUI();
            playTrack(currentTrackIndex);
            musicPlayer.classList.add('visible');
        } else {
            const errorMessage = 'فایل صوتی یافت نشد';
            nowPlayingElement.textContent = errorMessage;
            nowPlayingMobileElement.textContent = errorMessage;
            playlistElement.innerHTML = ''; 
            musicPlayer.classList.add('visible'); 
        }
    }
    event.target.value = null; 
}
    
    function buildPlaylistUI() {
        playlistElement.innerHTML = '';
        playlist.forEach((track, index) => {
            const li = document.createElement('li');
            li.textContent = track.name.replace(/\.[^/.]+$/, "");
            li.addEventListener('click', () => playTrack(index));
            playlistElement.appendChild(li);
        });
    }
    
function playTrack(index) {
    if (index < 0 || index >= playlist.length) return;

    if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
    }

    currentTrackIndex = index;
    const track = playlist[currentTrackIndex];
    const trackName = track.name.replace(/\.[^/.]+$/, "");

    const trackUrl = URL.createObjectURL(track);
    currentObjectUrl = trackUrl; 
    
    audioPlayer.src = trackUrl;
    audioPlayer.play().catch(e => console.error("Autoplay was prevented:", e));
    
    nowPlayingElement.textContent = trackName;
    nowPlayingMobileElement.textContent = trackName;
    
    updatePlayPauseIcon(true);
    updatePlaylistHighlight();
}

    function togglePlayPause() {
        if (audioPlayer.paused) {
            audioPlayer.play();
            updatePlayPauseIcon(true);
        } else {
            audioPlayer.pause();
            updatePlayPauseIcon(false);
        }
    }

    function playNext() {
        currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
        playTrack(currentTrackIndex);
    }

    function playPrev() {
        currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
        playTrack(currentTrackIndex);
    }

    function updatePlayPauseIcon(isPlaying) {
        if (isPlaying) {
            playIcon.style.display = 'none';
            pauseIcon.style.display = 'block';
        } else {
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
        }
    }

    function updatePlaylistHighlight() {
        const items = playlistElement.querySelectorAll('li');
        items.forEach((item, index) => {
            item.classList.toggle('playing', index === currentTrackIndex);
        });
    }

    function updateProgress() {
        const { duration, currentTime } = audioPlayer;
        if (duration) {
            const progressPercent = (currentTime / duration) * 100;
            musicProgressBar.style.width = `${progressPercent}%`;
            currentTimeEl.textContent = formatTime(currentTime);
        }
    }

    function setProgress(e) {
        const width = this.clientWidth;
        const clickX = e.offsetX;
        const duration = audioPlayer.duration;
        if (duration) {
            audioPlayer.currentTime = (clickX / width) * duration;
        }
    }

    function handleVolumeChange(e) {
        audioPlayer.volume = e.target.value;
        if (audioPlayer.volume > 0) isMuted = false;
        updateVolumeIcon();
    }

    function toggleMute() {
        isMuted = !isMuted;
        if (isMuted) {
            lastVolume = audioPlayer.volume > 0 ? audioPlayer.volume : 1;
            audioPlayer.volume = 0;
            volumeSlider.value = 0;
        } else {
            audioPlayer.volume = lastVolume;
            volumeSlider.value = lastVolume;
        }
        updateVolumeIcon();
    }

    function updateVolumeIcon() {
        if (isMuted || audioPlayer.volume === 0) {
            volumeIconOn.style.display = 'none';
            volumeIconOff.style.display = 'block';
        } else {
            volumeIconOn.style.display = 'block';
            volumeIconOff.style.display = 'none';
        }
    }

    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }
    
       const closePlayerBtn = document.getElementById('close-player-btn');
        closePlayerBtn.addEventListener('click', () => {
        musicPlayer.classList.remove('visible');
        audioPlayer.pause();
    });
    
  });
</script>
 
<button id="ai-fab" class="fab-button" aria-label="دستیار هوش مصنوعی">
  <span class="icon-combo">
    <i class="fa-solid fa-brain icon-back"></i>
    <i class="fa-solid fa-microchip icon-front"></i>
  </span>
  <span class="fab-tooltip">AI Assistant<br>دستیار هوش مصنوعی</span>
</button>

<button id="music-fab" class="fab-button" aria-label="پخش کننده موسیقی">
    <span class="icon-combo">
      <i class="fa-solid fa-music icon-back" style="font-size: 2rem;"></i>
      <i class="fa-solid fa-compact-disc icon-front"></i>
    </span>
    <span class="fab-tooltip">Music Player<br>پخش کننده موسیقی</span>
</button>
    
<input type="file" id="file-input" accept=".mp3,.ogg,.wav,.flac,.m4a" multiple webkitdirectory style="display: none;">

<div id="music-player">
<button id="close-player-btn" title="بستن">&times;</button>
<div id="now-playing-mobile">فایلی انتخاب نشده</div>
    <div id="playlist-container">
        <ol id="playlist"></ol>
    </div>
    <div class="center-controls">
        <div class="player-buttons">
            <button id="prev-btn" title="قبلی">
                <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"></path></svg>
            </button>
            <button id="play-pause-btn" title="پخش">
                <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
                <svg id="pause-icon" viewBox="0 0 24 24" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
            </button>
            <button id="next-btn" title="بعدی">
                <svg viewBox="0 0 24 24"><path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"></path></svg>
            </button>
        </div>
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div class="time-stamps">
            <span id="current-time">0:00</span>
            <span id="total-duration">0:00</span>
        </div>
    </div>
    <div class="info-volume-controls">
        <div id="now-playing">فایلی انتخاب نشده</div>
        <div class="volume-controls">
            <svg id="volume-icon-on" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>
             <svg id="volume-icon-off" viewBox="0 0 24 24" style="display:none;"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path></svg>
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
        </div>
    </div>
    <audio id="audio-player"></audio>
</div>

</body>
</html>
